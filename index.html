<html><head><base href="https://websim.joyful-finance.com/"><title>Gerenciamento SKFLIX IPTV</title><style>
body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}
header {
    background-color: #35a79c;
    color: #ffffff;
    text-align: center;
    padding: 1rem;
}
main {
    padding: 2rem;
    max-width: 800px;
    margin: 0 auto;
    background-color: #ffffff;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
h1, h2 {
    margin-bottom: 1rem;
}
form {
    display: flex;
    flex-direction: column;
    margin-bottom: 2rem;
}
input, select {
    margin-bottom: 1rem;
    padding: 0.5rem;
    font-size: 1rem;
}
button {
    background-color: #35a79c;
    color: #ffffff;
    border: none;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    cursor: pointer;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
}
button:hover {
    background-color: #2c8f86;
}
.tabs {
    display: flex;
    margin-bottom: 1rem;
}
.tab-button {
    padding: 0.5rem 1rem;
    background-color: #f2f2f2;
    border: none;
    cursor: pointer;
}
.tab-button.active {
    background-color: #35a79c;
    color: white;
}
.tab-content {
    display: none;
}
.tab-content.active {
    display: block;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
}
th, td {
    padding: 0.5rem;
    text-align: left;
    border-bottom: 1px solid #ddd;
}
th {
    background-color: #f2f2f2;
}
.total {
    font-weight: bold;
}
.paid {
    background-color: #d4edda;
}
.unpaid {
    background-color: #f8d7da;
}
.undefined {
    background-color: #ffeeba;
}
.overdue {
    background-color: #ffa07a;
}
.btn-paid {
    background-color: #28a745;
}
.btn-paid:hover {
    background-color: #218838;
}
.btn-unpaid {
    background-color: #dc3545;
}
.btn-unpaid:hover {
    background-color: #c82333;
}
.btn-delete {
    background-color: #dc3545;
    color: white;
}
.btn-delete:hover {
    background-color: #c82333;
}
.btn-info {
    background-color: #17a2b8;
}
.btn-info:hover {
    background-color: #138496;
}
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
}
.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
}
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}
.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
#embedContainer {
    margin-top: 1rem;
    border: 1px solid #ddd;
    padding: 1rem;
}
#embedFrame {
    border: none;
    width: 100%;
    height: 500px;
}
</style></head><body>
<header>
    <h1>Gerenciamento SKFLIX IPTV</h1>
</header>
<main>
    <h2>Adicionar Cliente</h2>
    <form id="clientForm">
        <input type="text" id="clientName" placeholder="Nome do Cliente" required>
        <input type="text" id="clientUsername" placeholder="Nome de Usuário" required>
        <input type="password" id="clientPassword" placeholder="Senha" required>
        <button type="submit">Adicionar Cliente</button>
    </form>

    <h2>Lista de Clientes</h2>
    <table id="clientTable">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Nome de Usuário</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Adicionar Pagamento</h2>
    <form id="paymentForm">
        <input type="date" id="date" required>
        <input type="text" id="description" placeholder="Descrição" required>
        <select id="type" required>
            <option value="credit">Crédito</option>
            <option value="debit">Débito</option>
        </select>
        <input type="number" id="amount" placeholder="Valor" step="0.01" required>
        <select id="clientSelect" required>
            <option value="">Selecione um cliente</option>
        </select>
        <button type="submit">Salvar Pagamento</button>
    </form>

    <h2>Pagamentos</h2>
    <div class="tabs">
        <button class="tab-button active" data-tab="regular-payments">Pagamentos Regulares</button>
        <button class="tab-button" data-tab="overdue-payments">Vencidos</button>
    </div>
    <div id="regular-payments" class="tab-content active">
        <table id="financeTable">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Tipo</th>
                    <th>Valor</th>
                    <th>Cliente</th>
                    <th>Status</th>
                    <th>Ação</th>
                </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr>
                    <td colspan="5" class="total">Total</td>
                    <td id="totalAmount" class="total" colspan="2">R$ 0.00</td>
                </tr>
            </tfoot>
        </table>
    </div>
    <div id="overdue-payments" class="tab-content">
        <table id="overdueTable">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Tipo</th>
                    <th>Valor</th>
                    <th>Cliente</th>
                    <th>Status</th>
                    <th>Ação</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <h2>Exportar/Importar Dados</h2>
    <button id="exportButton">Exportar Dados</button>
    <button id="importButton">Importar Dados</button>
    <input type="file" id="importFile" style="display:none;">

    <h2>Incorporar Site Externo</h2>
    <form id="embedForm">
        <input type="url" id="embedUrl" placeholder="https://exemplo.com" required>
        <button type="submit">Incorporar Site</button>
    </form>
    <div id="embedContainer">
        <iframe id="embedFrame" src="about:blank" width="100%" height="500px"></iframe>
    </div>
</main>

<div id="infoModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Informações do Cliente</h2>
        <p><strong>Nome:</strong> <span id="modalName"></span></p>
        <p><strong>Nome de Usuário:</strong> <span id="modalUsername"></span></p>
        <p><strong>Senha:</strong> <span id="modalPassword"></span></p>
    </div>
</div>

<script>
let clients = JSON.parse(localStorage.getItem('clients')) || [];
let finances = JSON.parse(localStorage.getItem('finances')) || [];

function addClient(event) {
    event.preventDefault();
    const client = {
        id: Date.now(),
        name: document.getElementById('clientName').value,
        username: document.getElementById('clientUsername').value,
        password: document.getElementById('clientPassword').value
    };
    clients.push(client);
    localStorage.setItem('clients', JSON.stringify(clients));
    updateClientTable();
    updateClientSelect();
    event.target.reset();
}

function updateClientTable() {
    const tbody = document.querySelector('#clientTable tbody');
    tbody.innerHTML = '';
    clients.forEach(client => {
        const row = tbody.insertRow();
        row.insertCell(0).textContent = client.name;
        row.insertCell(1).textContent = client.username;
        const actionCell = row.insertCell(2);
        
        const infoButton = document.createElement('button');
        infoButton.textContent = 'Info';
        infoButton.className = 'btn-info';
        infoButton.onclick = () => showClientInfo(client);
        actionCell.appendChild(infoButton);

        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Apagar';
        deleteButton.className = 'btn-delete';
        deleteButton.onclick = () => deleteClient(client.id);
        actionCell.appendChild(deleteButton);
    });
}

function updateClientSelect() {
    const select = document.getElementById('clientSelect');
    select.innerHTML = '<option value="">Selecione um cliente</option>';
    clients.forEach(client => {
        const option = document.createElement('option');
        option.value = client.id;
        option.textContent = client.name;
        select.appendChild(option);
    });
}

function showClientInfo(client) {
    document.getElementById('modalName').textContent = client.name;
    document.getElementById('modalUsername').textContent = client.username;
    document.getElementById('modalPassword').textContent = client.password;
    document.getElementById('infoModal').style.display = 'block';
}

function deleteClient(id) {
    if (confirm('Tem certeza que deseja apagar este cliente?')) {
        clients = clients.filter(client => client.id !== id);
        finances = finances.filter(payment => payment.clientId !== id);
        localStorage.setItem('clients', JSON.stringify(clients));
        localStorage.setItem('finances', JSON.stringify(finances));
        updateClientTable();
        updateClientSelect();
        updateFinanceTable();
    }
}

function savePayment(event) {
    event.preventDefault();
    const startDate = new Date(document.getElementById('date').value);
    const payment = {
        id: Date.now(),
        startDate: startDate.toISOString().split('T')[0],
        description: document.getElementById('description').value,
        type: document.getElementById('type').value,
        amount: parseFloat(document.getElementById('amount').value),
        clientId: document.getElementById('clientSelect').value,
        status: 'undefined',
        recurrenceId: Date.now()
    };
    finances.push(payment);
    generateRecurringPayments(payment);
    localStorage.setItem('finances', JSON.stringify(finances));
    updateFinanceTable();
    event.target.reset();
}

function generateRecurringPayments(initialPayment) {
    const today = new Date();
    let currentDate = new Date(initialPayment.startDate);
    while (currentDate <= today) {
        currentDate.setDate(currentDate.getDate() + 30);
        if (currentDate <= today) {
            removeOutdatedEntries(initialPayment.recurrenceId, currentDate);
            
            const recurringPayment = {
                ...initialPayment,
                id: Date.now() + Math.random(),
                startDate: currentDate.toISOString().split('T')[0],
                status: 'unpaid',
                recurrenceId: initialPayment.recurrenceId
            };
            finances.push(recurringPayment);
        }
    }
    localStorage.setItem('finances', JSON.stringify(finances));
}

function removeOutdatedEntries(recurrenceId, currentDate) {
    finances = finances.filter(payment => {
        if (payment.recurrenceId === recurrenceId) {
            const paymentDate = new Date(payment.startDate);
            const thirtyDaysAgo = new Date(currentDate);
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            return paymentDate >= thirtyDaysAgo;
        }
        return true;
    });
}

function updateFinanceTable() {
    const regularTbody = document.querySelector('#financeTable tbody');
    const overdueTbody = document.querySelector('#overdueTable tbody');
    regularTbody.innerHTML = '';
    overdueTbody.innerHTML = '';
    let total = 0;
    let uniqueClients = new Set();
    let unpaidTotal = 0;

    finances.sort((a, b) => new Date(a.startDate) - new Date(b.startDate)).forEach(payment => {
        const row = document.createElement('tr');
        row.className = payment.status;
        row.innerHTML = `
            <td>${payment.startDate}</td>
            <td>${payment.description}</td>
            <td>${payment.type === 'credit' ? 'Crédito' : 'Débito'}</td>
            <td>R$ ${payment.amount.toFixed(2)}</td>
            <td>${clients.find(client => client.id == payment.clientId)?.name || 'Cliente Desconhecido'}</td>
            <td>${getStatusText(payment.status)}</td>
            <td>
                <button class="btn-paid" onclick="toggleStatus(${payment.id}, 'paid')">Pago</button>
                <button class="btn-unpaid" onclick="toggleStatus(${payment.id}, 'unpaid')">Não Pago</button>
                <button class="btn-delete" onclick="deletePayment(${payment.id})">Apagar</button>
            </td>
        `;

        if (payment.status === 'overdue') {
            overdueTbody.appendChild(row);
        } else {
            regularTbody.appendChild(row);
        }

        if (payment.status === 'paid') {
            total += payment.type === 'credit' ? payment.amount : -payment.amount;
            uniqueClients.add(payment.clientId);
        } else {
            unpaidTotal += payment.type === 'credit' ? payment.amount : -payment.amount;
        }
    });

    const clientDiscount = uniqueClients.size * 5;
    total -= clientDiscount;

    document.getElementById('totalAmount').textContent = `R$ ${total.toFixed(2)}`;
    
    const discountNote = document.createElement('tr');
    discountNote.innerHTML = `<td colspan="7">Desconto de clientes: R$ ${clientDiscount.toFixed(2)} (R$ 5,00 por cliente com pagamentos pagos)</td>`;
    regularTbody.appendChild(discountNote);

    const unpaidNote = document.createElement('tr');
    unpaidNote.innerHTML = `<td colspan="7">Total não pago: R$ ${unpaidTotal.toFixed(2)}</td>`;
    regularTbody.appendChild(unpaidNote);
}

function getStatusText(status) {
    switch(status) {
        case 'paid':
            return 'Pago';
        case 'unpaid':
            return 'Não Pago';
        case 'overdue':
            return 'Vencido';
        default:
            return 'Indefinido';
    }
}

function toggleStatus(id, newStatus) {
    const index = finances.findIndex(payment => payment.id === id);
    if (index !== -1) {
        finances[index].status = newStatus;
        localStorage.setItem('finances', JSON.stringify(finances));
        updateFinanceTable();
    }
}

function deletePayment(id) {
    if (confirm('Tem certeza que deseja apagar este pagamento?')) {
        finances = finances.filter(payment => payment.id !== id);
        localStorage.setItem('finances', JSON.stringify(finances));
        updateFinanceTable();
    }
}

function exportData() {
    const data = {
        clients: clients,
        finances: finances
    };
    const dataStr = JSON.stringify(data);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    
    const currentDateTime = new Date().toLocaleString().replace(/[/,:]/g, '-').replace(/\s/g, '_');
    const exportFileDefaultName = `skflix_iptv_${currentDateTime}.txt`;

    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
}

function importData() {
    const fileInput = document.getElementById('importFile');
    const file = fileInput.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (data.clients && data.finances) {
                    clients = data.clients;
                    finances = data.finances;
                    localStorage.setItem('clients', JSON.stringify(clients));
                    localStorage.setItem('finances', JSON.stringify(finances));
                    updateClientTable();
                    updateClientSelect();
                    updateFinanceTable();
                    alert('Dados importados com sucesso!');
                } else {
                    throw new Error('Formato de dados inválido');
                }
            } catch (error) {
                alert('Erro ao importar dados: ' + error.message);
            }
        };
        reader.readAsText(file);
    }
}

function embedWebsite(event) {
    event.preventDefault();
    const url = document.getElementById('embedUrl').value;
    const iframe = document.getElementById('embedFrame');
    iframe.src = url;
}

function checkPaymentStatuses() {
    const today = new Date();
    finances.forEach(payment => {
        const paymentDate = new Date(payment.startDate);
        const thirtyDaysAgo = new Date(today);
        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
        
        if (paymentDate <= today && payment.status !== 'paid') {
            if (paymentDate <= thirtyDaysAgo) {
                payment.status = 'overdue';
            } else {
                payment.status = 'unpaid';
            }
        }
    });
    removeOutdatedEntries(null, today);
    localStorage.setItem('finances', JSON.stringify(finances));
    updateFinanceTable();
}

function initTabs() {
    const tabs = document.querySelectorAll('.tab-button');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tab.dataset.tab).classList.add('active');
        });
    });
}

document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('clientForm').addEventListener('submit', addClient);
    document.getElementById('paymentForm').addEventListener('submit', savePayment);
    document.getElementById('exportButton').addEventListener('click', exportData);
    document.getElementById('importButton').addEventListener('click', () => document.getElementById('importFile').click());
    document.getElementById('importFile').addEventListener('change', importData);
    document.getElementById('embedForm').addEventListener('submit', embedWebsite);

    updateClientTable();
    updateClientSelect();
    updateFinanceTable();
    initTabs();
});

checkPaymentStatuses();
setInterval(checkPaymentStatuses, 86400000);
</script>
</body></html>
